#

## 用户

用户直接继承自 algoUX 用户体系，如果有除昵称、用户名、邮箱、密码之外的，和出题平台相关的字段，可以新增额外字段。初始状态下，也需要有一个业务专属的扩展用户信息表（`ext_user_info`），里面主键为 `user_id`，数据类型需要为 `BIGINT`。当后续有需要扩展用户字段的时候，可以在这个表加入新字段。

## 题目

题目本质上是一个 git repo，repo 内文件内容是 spb 文件结构（或理解为解包后的全部文件）。借助 git 的能力，即可很方便地实现版本控制、多人协作等功能。

和 GitHub 等平台一样，repo 不可能孤立存在，而是必须从属于一个命名空间。例如 `github.com/dreamerblue/dainty-di` 这个项目，其命名空间是个人 `dreamerblue`，repo 为 `dainty-di`。而像 `github.com/sdutacm/onlinejudge3`，其命名空间是 `sdutacm`，其是一个组织。

与之类似，我们的题目也会从属于一个命名空间（即下一章节的 `空间` 概念）。

题目创建需要指定命名空间创建，而不能虚空创建。题目允许转移、克隆、引用或删除。

## 空间

空间是一个用来管理一组题目和成员的单位，类比于 GitHub 上的命名空间。

用户账号首次登入 ProbMirage 时，会创建一个个人空间。其 namespace 值就是用户名。

除个人空间外，还有一类空间是团队空间。其必须由用户创建。

### 空间成员

空间可以关联一位或多位用户。

个人空间的成员有且仅有创建者一人，且不可移除或变更权限类型。

团队空间的成员初始是创建者，可以通过邀请或成员克隆关联新成员到空间。每个成员有且只有一个固定的权限类型。关于权限类型，参见下一节。

### 空间成员权限

- 超级管理员：有且仅有一人，默认为创建者，超级管理员无法移除自身。可以邀请其他成员，可以修改除自己外的成员权限，可以转让权限，拥有题目的完全控制权限和完全空间管理能力
- 管理员：可以管理低于自己权限的成员，可以邀请成员，拥有题目的完全控制权限和大多数空间管理能力（不能删除空间）
- 协作者：只能添加或编辑题目，不具备成员管理能力和空间管理能力
- 测题人员：题目只读，只能测题验题

### 空间题目

题目必须从属于空间。当一个用户拥有此空间的题目权限时，他就可以操作这个题目。否则，题目对这个用户就是不可见的。

#### 空间题目操作

1. 转移：转移题目到其他空间，必须是空间管理员或超级管理员，且目标空间也需要拥有至少协作者权限
2. 删除：删除题目，必须是空间管理员或超级管理员
3. 克隆：克隆题目到其他有至少协作者权限的空间，将根据题目当前 commit 创建一个完全的镜像版本（等同于 GitHub 上的 fork）
4. 引用：引用题目到其他有至少协作者权限的空间，这个操作相当于创建指针。原题目发生变化时，所有引用题目均会一起变更（因为他们指向同一个底层存储）；当持有引用时，若直接在引用题目上进行编辑，也会直接修改到源题目，并引发所有引用一起变更。但是否可写取决于用户是否有源题目的至少协作者权限
